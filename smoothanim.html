<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ClockClock 24</title>
    <script src="https://cdn.tailwindcss.com/3.4.17"></script>
    <script src="/_sdk/element_sdk.js"></script>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      .app-wrapper {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        background: #f5f5f5;
      }

      #clock-display {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5%;
        width: 100%;
        height: 100%;
        padding: 2%;
        box-sizing: border-box;
        flex-wrap: wrap;
        align-content: center;
      }

      .digit-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(3, 1fr);
        gap: 0.3vw;
        flex: 1;
        aspect-ratio: 1 / 1.5;
      }

      .clock-cell {
        position: relative;
        width: 100%;
        height: 100%;
      }

      .clock {
        position: relative;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: #ffffff;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.25);
        --small-hand: -135deg;
        --large-hand: -45deg;
      }

      svg {
        width: 100%;
        height: 100%;
        display: block;
      }

      .clock-smallHand,
      .clock-largeHand {
        transform-origin: 50px center;
        transition: transform 3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .clock-smallHand {
        transform: rotateZ(var(--small-hand));
      }

      .clock-largeHand {
        transform: rotateZ(var(--large-hand));
      }

      .colon {
        flex: 0.3;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 15%;
      }

      .colon-dot {
        width: 2vw;
        height: 2vw;
        border-radius: 50%;
        animation: pulse 1s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }
    </style>
    <style>
      body {
        box-sizing: border-box;
      }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  </head>
  <body class="h-full">
    <div class="app-wrapper" id="app">
      <div id="clock-display"></div>
    </div>
    <script>
      // Default configuration
      const defaultConfig = {
        background_color_input: "#0f0f0f",
        clock_face_color_input: "#1a1a1a",
        hand_color_input: "#00ff41",
        accent_color_input: "#ff0055",
      };

      let config = { ...defaultConfig };
      let currentTime = "";

      // Digit patterns - hour and minute positions based on clock face (0-12 hours, 0-60 minutes)
      const digits = [
        [
          // 0
          { hour: 6, minute: 15 },
          { hour: 9, minute: 30 },
          { hour: 6, minute: 0 },
          { hour: 0, minute: 30 },
          { hour: 3, minute: 0 },
          { hour: 0, minute: 45 },
        ],
        [
          // 1
          { hour: 7.5, minute: 37.5 },
          { hour: 6, minute: 30 },
          { hour: 7.5, minute: 37.5 },
          { hour: 6, minute: 0 },
          { hour: 7.5, minute: 37.5 },
          { hour: 0, minute: 0 },
        ],
        [
          // 2
          { hour: 3, minute: 15 },
          { hour: 9, minute: 30 },
          { hour: 6, minute: 15 },
          { hour: 0, minute: 45 },
          { hour: 0, minute: 15 },
          { hour: 9, minute: 45 },
        ],
        [
          // 3
          { hour: 3, minute: 15 },
          { hour: 9, minute: 30 },
          { hour: 3, minute: 15 },
          { hour: 9, minute: 0 },
          { hour: 3, minute: 15 },
          { hour: 9, minute: 0 },
        ],
        [
          // 4
          { hour: 6, minute: 30 },
          { hour: 6, minute: 30 },
          { hour: 0, minute: 15 },
          { hour: 6, minute: 0 },
          { hour: 7.5, minute: 37.5 },
          { hour: 0, minute: 0 },
        ],
        [
          // 5
          { hour: 6, minute: 15 },
          { hour: 9, minute: 45 },
          { hour: 0, minute: 15 },
          { hour: 6, minute: 45 },
          { hour: 3, minute: 15 },
          { hour: 0, minute: 45 },
        ],
        [
          // 6
          { hour: 6, minute: 15 },
          { hour: 9, minute: 45 },
          { hour: 6, minute: 0 },
          { hour: 6, minute: 45 },
          { hour: 0, minute: 15 },
          { hour: 0, minute: 45 },
        ],
        [
          // 7
          { hour: 3, minute: 15 },
          { hour: 6, minute: 45 },
          { hour: 7.5, minute: 37.5 },
          { hour: 6, minute: 0 },
          { hour: 7.5, minute: 37.5 },
          { hour: 0, minute: 0 },
        ],
        [
          // 8
          { hour: 6, minute: 15 },
          { hour: 6, minute: 45 },
          { hour: 0, minute: 15 },
          { hour: 0, minute: 45 },
          { hour: 0, minute: 15 },
          { hour: 0, minute: 45 },
        ],
        [
          // 9
          { hour: 6, minute: 15 },
          { hour: 6, minute: 45 },
          { hour: 3, minute: 0 },
          { hour: 6, minute: 0 },
          { hour: 3, minute: 15 },
          { hour: 0, minute: 45 },
        ],
      ];

      function isValidHexColor(hex) {
        return /^#[0-9A-F]{6}$/i.test(hex);
      }

      function hourToDegrees(hour) {
        return hour * (360 / 12) - 90;
      }

      function minuteToDegrees(minute) {
        return minute * (360 / 60) - 90;
      }

      function setClockHands(clockElement, hour, minute) {
        const smallHandDeg = hourToDegrees(hour);
        const largeHandDeg = minuteToDegrees(minute);

        clockElement.style.setProperty("--small-hand", `${smallHandDeg}deg`);
        clockElement.style.setProperty("--large-hand", `${largeHandDeg}deg`);
      }

      function setDigit(digitIndex, digit) {
        const pattern = digits[digit];
        pattern.forEach((pos, index) => {
          const clockElement = document.querySelector(
            `.clock--${digitIndex * 6 + index}`,
          );
          if (clockElement) {
            setClockHands(clockElement, pos.hour, pos.minute);
          }
        });
      }

      function updateDisplay() {
        const now = new Date();
        const timeStr = now.toTimeString().slice(0, 5).replace(":", "");

        if (timeStr === currentTime) return;
        currentTime = timeStr;

        setDigit(0, parseInt(timeStr[0]));
        setDigit(1, parseInt(timeStr[1]));
        setDigit(2, parseInt(timeStr[2]));
        setDigit(3, parseInt(timeStr[3]));
      }

      function createClock(clockId, hour, minute) {
        const clockCell = document.createElement("div");
        clockCell.className = "clock-cell";

        const smallHandDeg = hourToDegrees(hour);
        const largeHandDeg = minuteToDegrees(minute);

        const clockFaceColor = isValidHexColor(config.clock_face_color_input)
          ? config.clock_face_color_input
          : defaultConfig.clock_face_color_input;
        const handColor = isValidHexColor(config.hand_color_input)
          ? config.hand_color_input
          : defaultConfig.hand_color_input;

        clockCell.innerHTML = `
        <div class="clock clock--${clockId}" style="--small-hand: ${smallHandDeg}deg; --large-hand: ${largeHandDeg}deg; background: ${clockFaceColor};">
          <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <path class="clock-smallHand" d="M50,47 C48.3431458,47 47,48.3431458 47,50 C47,51.6568542 48.3431458,53 50,53 L95,53 L95,47 L50,47 Z" stroke="none" fill="${handColor}" fill-rule="evenodd" />
            <path class="clock-largeHand" d="M50,47 C48.3431458,47 47,48.3431458 47,50 C47,51.6568542 48.3431458,53 50,53 L100,53 L100,47 L50,47 Z" stroke="none" fill="${handColor}" fill-rule="evenodd" />
          </svg>
        </div>
      `;
        return clockCell;
      }

      function createInitialDisplay() {
        const display = document.getElementById("clock-display");
        display.innerHTML = "";

        const bgColor = isValidHexColor(config.background_color_input)
          ? config.background_color_input
          : defaultConfig.background_color_input;
        display.style.background = bgColor;

        const now = new Date();
        const timeStr = now.toTimeString().slice(0, 5).replace(":", "");
        currentTime = timeStr;

        const digits1 = digits[parseInt(timeStr[0])];
        const digits2 = digits[parseInt(timeStr[1])];
        const digits3 = digits[parseInt(timeStr[2])];
        const digits4 = digits[parseInt(timeStr[3])];

        let clockId = 0;

        // First digit
        const digitGrid1 = document.createElement("div");
        digitGrid1.className = "digit-grid";
        digits1.forEach((pos) => {
          digitGrid1.appendChild(createClock(clockId, pos.hour, pos.minute));
          clockId++;
        });
        display.appendChild(digitGrid1);

        // Second digit
        const digitGrid2 = document.createElement("div");
        digitGrid2.className = "digit-grid";
        digits2.forEach((pos) => {
          digitGrid2.appendChild(createClock(clockId, pos.hour, pos.minute));
          clockId++;
        });
        display.appendChild(digitGrid2);

        // Colon
        const accentColor = isValidHexColor(config.accent_color_input)
          ? config.accent_color_input
          : defaultConfig.accent_color_input;
        const colon = document.createElement("div");
        colon.className = "colon";
        colon.innerHTML = `
        <div class="colon-dot" style="background: ${accentColor};"></div>
        <div class="colon-dot" style="background: ${accentColor};"></div>
      `;
        display.appendChild(colon);

        // Third digit
        const digitGrid3 = document.createElement("div");
        digitGrid3.className = "digit-grid";
        digits3.forEach((pos) => {
          digitGrid3.appendChild(createClock(clockId, pos.hour, pos.minute));
          clockId++;
        });
        display.appendChild(digitGrid3);

        // Fourth digit
        const digitGrid4 = document.createElement("div");
        digitGrid4.className = "digit-grid";
        digits4.forEach((pos) => {
          digitGrid4.appendChild(createClock(clockId, pos.hour, pos.minute));
          clockId++;
        });
        display.appendChild(digitGrid4);
      }

      function applyConfig() {
        const bgColor = isValidHexColor(config.background_color_input)
          ? config.background_color_input
          : defaultConfig.background_color_input;
        document.body.style.background = bgColor;
        document.getElementById("app").style.background = bgColor;
        currentTime = "";
        createInitialDisplay();
      }

      // Initialize
      async function init() {
        if (window.elementSdk) {
          await window.elementSdk.init({
            defaultConfig,
            onConfigChange: async (newConfig) => {
              config = { ...defaultConfig, ...newConfig };
              applyConfig();
            },
            mapToCapabilities: (cfg) => ({
              recolorables: [],
              borderables: [],
              fontEditable: undefined,
              fontSizeable: undefined,
            }),
            mapToEditPanelValues: (cfg) =>
              new Map([
                [
                  "background_color_input",
                  cfg.background_color_input ||
                    defaultConfig.background_color_input,
                ],
                [
                  "clock_face_color_input",
                  cfg.clock_face_color_input ||
                    defaultConfig.clock_face_color_input,
                ],
                [
                  "hand_color_input",
                  cfg.hand_color_input || defaultConfig.hand_color_input,
                ],
                [
                  "accent_color_input",
                  cfg.accent_color_input || defaultConfig.accent_color_input,
                ],
              ]),
          });
          config = { ...defaultConfig, ...window.elementSdk.config };
        }

        applyConfig();
        setInterval(updateDisplay, 1000);
      }

      init();
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'9cde0865124738b1',t:'MTc3MTA4NzQ5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
